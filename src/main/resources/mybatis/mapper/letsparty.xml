<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.letsparty.mapper.LetsPartyMapper">
	<insert id="insertPost" parameterType="com.letsparty.vo.LetsPartyPost">
		insert into letsparty_post (category_no, party_no, user_id, post_title, post_content)
		values (#{category.no}, #{party.no}, #{user.id}, #{title}, #{content})
	</insert>
	
	<select id="getTotalRows" parameterType="map" resultType="int">
		select
			count(*)
		from letsparty_post lt
		inner join party p on lt.party_no = p.party_no
		<where>
			<choose>
				<when test="opt == 'title'">
					post_title like concat('%',#{keyword},'%')
				</when>
				<when test="opt == 'content'">
					post_content like concat('%',#{keyword},'%')
				</when>
				<when test="opt == 'party'">
					p.party_name like concat('%',#{keyword},'%')
				</when>
			</choose>
		</where>
	</select>
	
	<select id="getPosts" parameterType="map" resultType="com.letsparty.vo.LetsPartyPost">
		select lt.post_no, lt.post_title, party_name, lt.created_at, post_read_cnt, post_comment_cnt
		from letsparty_post lt
		
		inner join party p on lt.party_no = p.party_no
	</select>
</mapper>
