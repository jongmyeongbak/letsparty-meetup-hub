<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.letsparty.mapper.CommentMapper">

 	<insert id="insertComment" parameterType="Comment" useGeneratedKeys="true" keyProperty="no">
	    insert into comment (post_id, user_id, comment_content, comment_updated_at, comment_created_at)
	    values (#{post.id}, #{user.id}, #{content}, NOW(), NOW())
	</insert> 
	
	 	<!-- 모든 댓글을 가져오는 쿼리 -->
	<select id="getAllCommentsByPostNo" parameterType="long" resultType="com.letsparty.dto.PartyCommentDto">
	    SELECT
	    c.comment_no AS no,
	    p.post_id AS "post.id",
	    p.party_no AS "post.party.no",
	    p.post_title AS "post.party.name",
	    up.profile_nickname AS "user.profile.nickname",
	    c.user_id AS "user.id",
	    up.image_filename AS "user.profile.imageFilename",
	    c.comment_content AS content,
	    c.comment_updated_at AS updatedAt,
	    c.comment_created_at AS createdAt
	    FROM comment c
	    INNER JOIN post p ON c.post_id = p.post_id
	    INNER JOIN user_party_application upa ON p.party_no = upa.party_no AND c.user_id = upa.user_id
	    INNER JOIN user_profile up ON upa.profile_no = up.profile_no
	    WHERE c.post_id = #{postId} <!-- 수정된 부분: post_no 대신 post_id 사용 -->
	    ORDER BY c.comment_created_at ASC
	</select>
    
</mapper>